(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0d09f7"],{6986:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"vue-views-wrapper"},[a("account-detail-table"),a("div",{staticClass:"xu-row mt-integer"},[a("div",{staticClass:"xu-col-12"},[a("login-record-table")],1)]),a("div",{staticClass:"xu-row mt-integer"},[a("div",{staticClass:"xu-col-12"},[a("operation-record-table")],1)])],1)},o=[],s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"xubox"},[a("div",{staticClass:"xubox-title"},[a("span",[t._v("账号情况")]),a("span",{staticClass:"xu-indicator xu-indicator-add xu-float-right",on:{click:t.addNewAccount}},[t._v("添加账号")])]),a("div",{staticClass:"xubox-content"},[a("table",{staticClass:"xu-table xu-table-center xu-table-hover"},[t._m(0),a("tbody",t._l(t.accountInfos,function(e){return a("tr",{key:e.accountId},[a("td",[t._v(t._s(e.accountId))]),a("td",[t._v(t._s(e.username))]),a("td",[t._v(t._s(e.role.roleName))]),a("td",[t._v(t._s(e.mobile))]),a("td",[t._v(t._s(e.company.companyName))]),a("td",[a("xu-switch",{attrs:{value:t._f("statusFilter")(e.status)},on:{hasSelected:function(a){return t.enableAccount(a,e)}}})],1),a("td",[t._v(t._s(e.createTime))]),a("td",[a("span",{staticClass:"xu-indicator xu-indicator-edit",on:{click:function(a){return t.editAccount(e)}}},[t._v("修改")]),a("span",{staticClass:"xu-indicator xu-indicator-delete",on:{click:function(a){return t.delAccount(e.accountId)}}},[t._v("删除")]),a("span",{staticClass:"xu-indicator xu-indicator-basic",on:{click:function(a){return t.showEditPasswordForm(e)}}},[t._v("修改密码")])])])}),0)])]),t.isFormShown?a("xu-form",{attrs:{"is-pop-up":!0,"form-title":t.formTitle,"render-data":t.formRenderData},on:{submit:function(e){return t.submit(e)},close:function(e){t.isFormShown=!1}}}):t._e(),t.isPasswordModalShown?a("modify-password-pop-up",{on:{changePsw:function(e){return t.changePsw(e)},close:function(e){t.isPasswordModalShown=!1}}}):t._e()],1)},i=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("thead",{staticClass:"xu-bg-silver"},[a("tr",[a("th",[t._v("#账号ID")]),a("th",[t._v("用户名")]),a("th",[t._v("角色")]),a("th",[t._v("手机号")]),a("th",[t._v("所属公司")]),a("th",[t._v("启用")]),a("th",[t._v("创建时间")]),a("th",[t._v("操作")])])])}],c=(a("7f7f"),a("ac6a"),a("f5e7")),r=a("b10a"),l=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("xu-modal",{attrs:{shown:!0,"header-shown":!0,"footer-shown":!0,"header-style":{backgroundColor:"#00a8b3",color:"#ffffff"}},on:{close:t.close}},[a("div",{attrs:{slot:"header"},slot:"header"},[a("span",[t._v("修改密码")])]),a("div",{attrs:{slot:"content"},slot:"content"},[a("div",{staticClass:"xu-form-control"},[a("label",{staticClass:"xu-label-text"},[a("span",[t._v("新密码：")]),a("input",{directives:[{name:"model",rawName:"v-model",value:t.password,expression:"password"}],staticClass:"xu-input",class:{"xu-illegal-border":!t.isValidate},attrs:{type:"text"},domProps:{value:t.password},on:{input:function(e){e.target.composing||(t.password=e.target.value)}}})]),t.isValidate?t._e():a("p",{staticClass:"xu-illegal-text"},[t._v("密码只能是8到12位的数字或者字母")])])]),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("div",{staticClass:"xu-text-center"},[a("button",{staticClass:"xu-btn xu-btn-primary mr-integer",on:{click:t.submit}},[t._v("确认")]),a("button",{staticClass:"xu-btn xu-btn-cancel mb-integer",on:{click:t.close}},[t._v("取消")])])])])},u=[],d=a("c41d"),m={name:"ModifyPasswordPopUp",components:{XuModal:d["a"]},data:function(){return{password:"",isValidate:!0}},methods:{close:function(){this.$emit("close")},submit:function(){var t=/^\w{8,12}$/;this.isValidate=t.test(this.password),this.isValidate&&this.$emit("changePsw",this.password)}}},h=m,f=a("2877"),p=Object(f["a"])(h,l,u,!1,null,"144ec74a",null),v=p.exports,_={name:"AccountDetailTable",components:{XuSwitch:c["a"],XuForm:r["a"],ModifyPasswordPopUp:v},data:function(){return{accountInfos:[],optionalRoles:[],optionalCompany:[],isFormShown:!1,formRenderData:[],formTitle:"",submitType:0,selectedAccount:null,isPasswordModalShown:!1}},methods:{getAccountInfos:function(){var t=this;this.$Http["accountManage"]["getAccountInfos"]().then(function(e){t.accountInfos=[],e.forEach(function(e){var a=e.role,n=e.company;t.accountInfos.push({accountId:e.id,username:e.username,mobile:e.mobile,status:e.status,role:{roleId:a["id"],roleName:a["roleName"]},company:{companyId:n["id"],companyName:n["name"]},createTime:e.createTime})})})},getOptionalRoles:function(){var t=this;this.optionalRoles=[],this.$Http["roleManage"]["getRoleInfos"]().then(function(e){e.forEach(function(e){t.optionalRoles.push({roleId:e["id"],roleName:e["roleName"]})})})},getOptionalCompany:function(){var t=this;this.optionalCompany=[],this.$Http["backendManage"]["getCompanyInfos"]().then(function(e){e.forEach(function(e){t.optionalCompany.push({companyId:e["id"],companyName:e["name"]})})})},addNewAccount:function(){this.formTitle="新建账号",this.submitType=0,this.formRenderData=[{content:"用户名：",value:"",field:"username"},{content:"密码：",value:"",field:"password"},{content:"手机号：",value:"",field:"mobile"},{content:"选择角色：",value:"",field:"role",additionalInfo:{type:"select",optional:this.optionalRoles.map(function(t){return t["roleName"]})}},{content:"选择公司：",value:"",field:"company",additionalInfo:{type:"select",optional:this.optionalCompany.map(function(t){return t["companyName"]})}}],this.isFormShown=!0},editAccount:function(t){this.selectedAccount=t,this.formTitle="修改账号信息",this.submitType=1,this.formRenderData=[{content:"用户名：",value:t["username"],field:"username"},{content:"手机号：",value:t["mobile"],field:"mobile"},{content:"选择角色：",value:t["role"]["roleName"],field:"role",additionalInfo:{type:"select",optional:this.optionalRoles.map(function(t){return t["roleName"]})}},{content:"选择公司：",value:t["company"]["companyName"],field:"company",additionalInfo:{type:"select",optional:this.optionalCompany.map(function(t){return t["companyName"]})}}],this.isFormShown=!0},enableAccount:function(t,e){console.log(t);var a={id:e["accountId"],username:e["username"],mobile:e["mobile"],status:0,role:{id:e["role"]["roleId"]},company:{id:e["company"]["companyId"]}};switch(t){case"on":a["status"]=1,this.$Http["accountManage"]["editAccountInfo"](a).then();break;case"off":this.$Http["accountManage"]["editAccountInfo"](a).then();break}},delAccount:function(t){var e=this;this.$Http["accountManage"]["delAccountInfo"](t).then(function(t){t&&e.getAccountInfos()})},showEditPasswordForm:function(t){this.isPasswordModalShown=!0,this.selectedAccount=t},changePsw:function(t){var e={id:this.selectedAccount["accountId"],password:t};this.isPasswordModalShown=!1,this.$Http["accountManage"]["modifyPassword"](e).then()},submit:function(t){for(var e=this,a=0;a<this.optionalRoles.length;a++)if(this.optionalRoles[a]["roleName"]===t["role"]){t["role"]={id:this.optionalRoles[a]["roleId"]};break}for(var n=0;n<this.optionalCompany.length;n++)if(this.optionalCompany[n]["companyName"]===t["company"]){t["company"]={id:this.optionalCompany[n]["companyId"]};break}switch(this.submitType){case 0:t["status"]=1,this.$Http["accountManage"]["postAccountInfo"](t).then(function(t){console.log(t),t&&e.getAccountInfos()});break;case 1:t["id"]=this.selectedAccount["accountId"],t["status"]=this.selectedAccount["status"],this.$Http["accountManage"]["editAccountInfo"](t).then(function(t){t&&e.getAccountInfos()});break}}},filters:{statusFilter:function(t){switch(t){case 0:return"off";case 1:return"on";default:return"off"}}},created:function(){this.getAccountInfos(),this.getOptionalRoles(),this.getOptionalCompany()}},b=_,g=Object(f["a"])(b,s,i,!1,null,"0b38c990",null),x=g.exports,w=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"xubox"},[a("div",{staticClass:"xubox-title"},[t._v("\n    登录日志\n  ")]),a("div",{staticClass:"xubox-content"},[a("table",{staticClass:"xu-table xu-table-center xu-table-hover"},[t._m(0),a("tbody",t._l(t.serverData.content,function(e){return a("tr",{key:e.id},[a("td",[t._v(t._s(e.userName))]),a("td",[t._v(t._s(e.loginTime))]),a("td",[t._v(t._s(t._f("msFilter")(e.onlineTime)))])])}),0)]),a("div",{staticClass:"xu-text-center"},[a("xu-page-nav",{attrs:{"is-shown":!0,size:t.serverData.size,"now-page":t.serverData.number,"total-elements":t.serverData.totalElements,"total-page":t.serverData.totalPages},on:{selectedPage:function(e){return t.jumpSelectedPage(e)}}})],1)])])},y=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("thead",{staticClass:"xu-bg-silver"},[a("tr",[a("th",[t._v("用户名")]),a("th",[t._v("登录时间")]),a("th",[t._v("在线时长")])])])}],C=a("9502"),I={components:{XuPageNav:C["a"]},data:function(){return{serverData:{}}},created:function(){this.getData()},methods:{getData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.$Http["accountManage"]["getUserLoginRecord"]("",{params:{start:e}}).then(function(e){t.serverData=e}).catch(function(t){console.log("登录日志数据解析出错")})},jumpSelectedPage:function(t){this.getData(t-1)}},filters:{msFilter:function(t){if(t<=0)return"无";var e=Math.floor(t/864e5),a=Math.floor(t%864e5/36e5),n=Math.floor(t%864e5%36e5/6e4),o="";return e?o=o+e+"天":o+="",a?o=o+a+"小时":o+="",n?o=o+n+"分钟":o+="",o}}},A=I,D=Object(f["a"])(A,w,y,!1,null,"42e06de6",null),P=D.exports,M=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"xubox"},[a("div",{staticClass:"xubox-title"},[t._v("\n    用户操作日志\n  ")]),a("div",{staticClass:"xubox-content"},[a("table",{staticClass:"xu-table xu-table-center xu-table-hover"},[t._m(0),a("tbody",t._l(t.serverData.content,function(e){return a("tr",{key:e.id},[a("td",[t._v(t._s(e.username))]),a("td",[t._v(t._s(e.operation))]),a("td",[t._v(t._s(e.method))]),a("td",[t._v(t._s(e.params))]),a("td",[t._v(t._s(e.time))]),a("td",[t._v(t._s(e.ip))]),a("td",[t._v(t._s(e.createDate))])])}),0)]),a("div",{staticClass:"xu-text-center"},[a("xu-page-nav",{attrs:{"is-shown":!0,size:t.serverData.size,"now-page":t.serverData.number,"total-elements":t.serverData.totalElements,"total-page":t.serverData.totalPages},on:{selectedPage:function(e){return t.jumpSelectedPage(e)}}})],1)])])},N=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("thead",{staticClass:"xu-bg-silver"},[a("tr",[a("th",[t._v("用户名")]),a("th",[t._v("操作")]),a("th",[t._v("操作方法")]),a("th",[t._v("请求参数")]),a("th",[t._v("请求时长")]),a("th",[t._v("操作IP")]),a("th",[t._v("操作时间")])])])}],$={components:{XuPageNav:C["a"]},data:function(){return{serverData:{}}},created:function(){this.getData()},methods:{getData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.$Http["accountManage"]["getOperationRecord"]("",{params:{start:e}}).then(function(e){t.serverData=e}).catch(function(t){console.log("操作日志数据解析出错")})},jumpSelectedPage:function(t){this.getData(t-1)}}},k=$,R=Object(f["a"])(k,M,N,!1,null,"8b0e1562",null),T=R.exports,S={name:"AccountManage",components:{AccountDetailTable:x,LoginRecordTable:P,OperationRecordTable:T}},E=S,F=Object(f["a"])(E,n,o,!1,null,"4611156b",null);e["default"]=F.exports}}]);
//# sourceMappingURL=chunk-2d0d09f7.14d74fb7.js.map